<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Skatemate Motorcontrol: mc/mc_foc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Skatemate Motorcontrol
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('mc__foc_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mc_foc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>FOC implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="mc__foc_8h_source.html">mc_foc.h</a>&quot;</code><br />
<code>#include &quot;ch.h&quot;</code><br />
<code>#include &quot;hal.h&quot;</code><br />
<code>#include &quot;chbsem.h&quot;</code><br />
<code>#include &quot;<a class="el" href="defs_8h_source.html">defs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="util_8h_source.html">util.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="usbcdc_8h_source.html">usbcdc.h</a>&quot;</code><br />
<code>#include &quot;arm_math.h&quot;</code><br />
<code>#include &quot;stm32f30x_conf.h&quot;</code><br />
<code>#include &quot;<a class="el" href="utelemetry_8h_source.html">utelemetry.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="drv8301_8h_source.html">drv8301.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpi_struct__t.html">piStruct_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsample__t.html">sample_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga1c3a2cd7a6c5f7a9eecdd57186030e42"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga1c3a2cd7a6c5f7a9eecdd57186030e42">DEBUG_CONTROLLERS</a></td></tr>
<tr class="separator:ga1c3a2cd7a6c5f7a9eecdd57186030e42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga71437ade895489e574688993ae6d6082"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DEBUG_DOWNSAMPLE_FACTOR</b>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ga71437ade895489e574688993ae6d6082"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabb71c1732d1cf1661c1e670ca249e3ab"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gabb71c1732d1cf1661c1e670ca249e3ab">FOC_F_SW</a>&#160;&#160;&#160;20000</td></tr>
<tr class="separator:gabb71c1732d1cf1661c1e670ca249e3ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaac0cf2145b56c99fc2d88a2f27e78edf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gaac0cf2145b56c99fc2d88a2f27e78edf">FOC_PWM_DEADTIME_CYCLES</a>&#160;&#160;&#160;20</td></tr>
<tr class="separator:gaac0cf2145b56c99fc2d88a2f27e78edf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4037684d40fadb7e24f528840989d636"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga4037684d40fadb7e24f528840989d636">FOC_THREAD_INTERVAL</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:ga4037684d40fadb7e24f528840989d636"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga604d0519514e5026b51fe02218131e56"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga604d0519514e5026b51fe02218131e56">FOC_CURRENT_CONTROLLER_SLOWDOWN</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ga604d0519514e5026b51fe02218131e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gacfb31a6a2e694e135c30668eea277662"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gacfb31a6a2e694e135c30668eea277662">FOC_SPEED_CONTROLLER_SLOWDOWN</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:gacfb31a6a2e694e135c30668eea277662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga608388f822b56bbc2063e21b48fdb599"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga608388f822b56bbc2063e21b48fdb599">FOC_VOLT_MEAS_SLOWDOWN</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:ga608388f822b56bbc2063e21b48fdb599"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad4bed45bfce24edabd6294babc9f1197"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gad4bed45bfce24edabd6294babc9f1197">FOC_FORCED_COMM_FREQ</a>&#160;&#160;&#160;30.0</td></tr>
<tr class="separator:gad4bed45bfce24edabd6294babc9f1197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga870d0392f4d39a91e5dab169ab440d02"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_FORCED_COMM_VD</b>&#160;&#160;&#160;0.0</td></tr>
<tr class="separator:ga870d0392f4d39a91e5dab169ab440d02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e2b81043cce8079564ec7bab1f6426e"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_FORCED_COMM_VQ</b>&#160;&#160;&#160;0.07</td></tr>
<tr class="separator:ga5e2b81043cce8079564ec7bab1f6426e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c5b6269c03aaff1a01cdb6fa75a5d45"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga3c5b6269c03aaff1a01cdb6fa75a5d45">FOC_PARAM_DEFAULT_CURR_MAX</a>&#160;&#160;&#160;20.0</td></tr>
<tr class="separator:ga3c5b6269c03aaff1a01cdb6fa75a5d45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae446dae77e124e7720ec857b3162d629"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gae446dae77e124e7720ec857b3162d629">FOC_PARAM_DEFAULT_CURR_FAC_DEADBAND</a>&#160;&#160;&#160;0.05</td></tr>
<tr class="separator:gae446dae77e124e7720ec857b3162d629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae0e409cfd9afc32497c85da2cd3edd22"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gae0e409cfd9afc32497c85da2cd3edd22">FOC_MOTOR_DEFAULT_PSI</a>&#160;&#160;&#160;15.0e-3</td></tr>
<tr class="separator:gae0e409cfd9afc32497c85da2cd3edd22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8cb08d6c08c2cf1928643239d1cb15c2"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_MOTOR_DEFAULT_P</b>&#160;&#160;&#160;7</td></tr>
<tr class="separator:ga8cb08d6c08c2cf1928643239d1cb15c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9cf13f7130490b835697684fc1e65035"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_MOTOR_DEFAULT_LS</b>&#160;&#160;&#160;35.0e-6</td></tr>
<tr class="separator:ga9cf13f7130490b835697684fc1e65035"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga29a7456becd41f070a9acccbbc4a228d"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_MOTOR_DEFAULT_RS</b>&#160;&#160;&#160;0.1</td></tr>
<tr class="separator:ga29a7456becd41f070a9acccbbc4a228d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac3a69c38b1c7db5fc82636782a3ab0ff"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_MOTOR_DEFAULT_J</b>&#160;&#160;&#160;150e-6</td></tr>
<tr class="separator:gac3a69c38b1c7db5fc82636782a3ab0ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga998225402f78fbb6bc823ce4d4cee3f9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga998225402f78fbb6bc823ce4d4cee3f9">FOC_PARAM_DEFAULT_OBS_GAIN</a>&#160;&#160;&#160;17e6</td></tr>
<tr class="separator:ga998225402f78fbb6bc823ce4d4cee3f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga591517a0b1203c6ffb522cfe80e86d78"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_OBS_SPEED_KP</b>&#160;&#160;&#160;2000.0</td></tr>
<tr class="separator:ga591517a0b1203c6ffb522cfe80e86d78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadf33ef164e3847f69e2a06d643d6d2ea"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_OBS_SPEED_KI</b>&#160;&#160;&#160;20000.0</td></tr>
<tr class="separator:gadf33ef164e3847f69e2a06d643d6d2ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9573bf3355a3c00339cc414c4b1550b8"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_OBS_SPEED_ITERM_MAX</b>&#160;&#160;&#160;10.0</td></tr>
<tr class="separator:ga9573bf3355a3c00339cc414c4b1550b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga49eb0a9c92175d1fdb28453c6ef5db3c"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_OBS_SPEED_ITERM_MIN</b>&#160;&#160;&#160;-10.0</td></tr>
<tr class="separator:ga49eb0a9c92175d1fdb28453c6ef5db3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga714a0bbc709f7fefbf094b8784c062ab"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_CURR_D_KP</b>&#160;&#160;&#160;0.01</td></tr>
<tr class="separator:ga714a0bbc709f7fefbf094b8784c062ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4e5457ab50529615ed0b1760fa715760"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_CURR_D_KI</b>&#160;&#160;&#160;0.0</td></tr>
<tr class="separator:ga4e5457ab50529615ed0b1760fa715760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3ad098e114b8de0a80cc25dc4d630abf"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_CURR_Q_KP</b>&#160;&#160;&#160;0.01</td></tr>
<tr class="separator:ga3ad098e114b8de0a80cc25dc4d630abf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga42c5e4082cf9c724ab912e311baf9cf8"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_CURR_Q_KI</b>&#160;&#160;&#160;0.0</td></tr>
<tr class="separator:ga42c5e4082cf9c724ab912e311baf9cf8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0cada986b9f208c031c2be6f0c7e3f64"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_ITERM_CEIL</b>&#160;&#160;&#160;100.0</td></tr>
<tr class="separator:ga0cada986b9f208c031c2be6f0c7e3f64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab5f679632885b2294c16cbb290eac0e2"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_ITERM_FLOOR</b>&#160;&#160;&#160;-100.0</td></tr>
<tr class="separator:gab5f679632885b2294c16cbb290eac0e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7fbf1bb88c663d9dc8ae4fb0a34d690f"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_SPEED_KP</b>&#160;&#160;&#160;0.2</td></tr>
<tr class="separator:ga7fbf1bb88c663d9dc8ae4fb0a34d690f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0001ebcbcc8070ad0a8667024e8791e1"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAM_DEFAULT_SPEED_KI</b>&#160;&#160;&#160;1.0</td></tr>
<tr class="separator:ga0001ebcbcc8070ad0a8667024e8791e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8143f4d02adda062f528e8c5613b9974"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_LP_FAST_CONSTANT</b>&#160;&#160;&#160;0.1</td></tr>
<tr class="separator:ga8143f4d02adda062f528e8c5613b9974"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab85fcc4f8aa7e4fa9b4b131a1fab0612"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_PARAPM_DEFAULT_O_CURRENT_MAX</b>&#160;&#160;&#160;50.0</td></tr>
<tr class="separator:gab85fcc4f8aa7e4fa9b4b131a1fab0612"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafd546853d56a1260c3d5b1521b3e5660"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gafd546853d56a1260c3d5b1521b3e5660">BOARD_ADC_PIN_TO_VOLT</a>&#160;&#160;&#160;(17.1183)</td></tr>
<tr class="memdesc:gafd546853d56a1260c3d5b1521b3e5660"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resistor divider for voltage measurements. <br /></td></tr>
<tr class="separator:gafd546853d56a1260c3d5b1521b3e5660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8624aed2a793582618f11c452ef4a89"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gaa8624aed2a793582618f11c452ef4a89">BOARD_ADC_PIN_TO_AMP</a>&#160;&#160;&#160;(float)(1000.0/<a class="el" href="group___m_c.html#ga9457c0a22a4b4009ced3b422c7b6e0a7">DRV_CURRENT_GAIN</a>)</td></tr>
<tr class="memdesc:gaa8624aed2a793582618f11c452ef4a89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shunt resistor for current measurement. <br /></td></tr>
<tr class="separator:gaa8624aed2a793582618f11c452ef4a89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1d1542b8e55cb457184c46252c0d32d5"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FOC_MEASURE_RES_NUM_SAMPLES</b>&#160;&#160;&#160;1000</td></tr>
<tr class="separator:ga1d1542b8e55cb457184c46252c0d32d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabc1d28c37cc453d1c5f32da262541c48"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_PH_A</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:gabc1d28c37cc453d1c5f32da262541c48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga58160d909778a324c26a44cb4f3ebee8"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_PH_B</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga58160d909778a324c26a44cb4f3ebee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaecd39661e06389c09579ef2da180069e"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_PH_C</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:gaecd39661e06389c09579ef2da180069e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga57c9f51a7cffeceac095a6287b1997d0"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_SUPPL</b>&#160;&#160;&#160;3</td></tr>
<tr class="separator:ga57c9f51a7cffeceac095a6287b1997d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadbcc9620e89ff221449004114727ac66"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_CURR_A</b>&#160;&#160;&#160;5</td></tr>
<tr class="separator:gadbcc9620e89ff221449004114727ac66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaac78c3eaa63eb50c92be4bc0d0a35b49"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_CURR_B</b>&#160;&#160;&#160;4</td></tr>
<tr class="separator:gaac78c3eaa63eb50c92be4bc0d0a35b49"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga47555550618b05503ade9fb913b2435a"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_TEMP</b>&#160;&#160;&#160;6</td></tr>
<tr class="separator:ga47555550618b05503ade9fb913b2435a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac66a47e7aab19eb9500d8007088a8b5e"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CH_REF</b>&#160;&#160;&#160;7</td></tr>
<tr class="separator:gac66a47e7aab19eb9500d8007088a8b5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga974244cd7d8e0646af306a928e05466a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga974244cd7d8e0646af306a928e05466a">ADC_STORE_DEPTH</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga974244cd7d8e0646af306a928e05466a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga32c3c48627bde0562c322cbd2af78654"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>OBS_STORE_DEPTH</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga32c3c48627bde0562c322cbd2af78654"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85f34c4c4db07b43fcce1f74cf8f7e59"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CONT_STORE_DEPTH</b>&#160;&#160;&#160;800</td></tr>
<tr class="separator:ga85f34c4c4db07b43fcce1f74cf8f7e59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5ded556c14e4ecef38428f3f92f0d0dc"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SVM_STORE_DEPTH</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga5ded556c14e4ecef38428f3f92f0d0dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85f04851b84096664f51d23b90704425"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DBGISR</b>(X, ...)&#160;&#160;&#160;chsnprintf(mIsrDbgString, sizeof(mIsrDbgString), X, ##__VA_ARGS__ )</td></tr>
<tr class="separator:ga85f04851b84096664f51d23b90704425"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga87e1b83958a1741c01d9e6bd4726da4f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga87e1b83958a1741c01d9e6bd4726da4f">TIMER_UPDATE_DUTY</a>(duty1,  duty2,  duty3)</td></tr>
<tr class="memdesc:ga87e1b83958a1741c01d9e6bd4726da4f"><td class="mdescLeft">&#160;</td><td class="mdescRight">synchronous update of the PWM duty cycles  <a href="group___m_c.html#ga87e1b83958a1741c01d9e6bd4726da4f">More...</a><br /></td></tr>
<tr class="separator:ga87e1b83958a1741c01d9e6bd4726da4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga00f13f2fb83a7ac4f11554bf5a056077"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga00f13f2fb83a7ac4f11554bf5a056077">FOC_TIM_PERIOD</a>&#160;&#160;&#160;SYSTEM_CORE_CLOCK / <a class="el" href="group___m_c.html#gabb71c1732d1cf1661c1e670ca249e3ab">FOC_F_SW</a> / 2</td></tr>
<tr class="separator:ga00f13f2fb83a7ac4f11554bf5a056077"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga17449bc979b418765fe2493f096e006f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga17449bc979b418765fe2493f096e006f">FOC_TIM1_OC4_VALUE</a>&#160;&#160;&#160;<a class="el" href="group___m_c.html#ga00f13f2fb83a7ac4f11554bf5a056077">FOC_TIM_PERIOD</a> - 1</td></tr>
<tr class="separator:ga17449bc979b418765fe2493f096e006f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga20ac88fd0e586934a686cd94507acede"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga20ac88fd0e586934a686cd94507acede">ADC_PIN</a>(ch)&#160;&#160;&#160;( (float)mADCValue[ch] * mADCtoPinFactor)</td></tr>
<tr class="memdesc:ga20ac88fd0e586934a686cd94507acede"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the ADC voltage on the pin. <br /></td></tr>
<tr class="separator:ga20ac88fd0e586934a686cd94507acede"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae008b1ced99b03c8a3c7487f647ee61a"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gae008b1ced99b03c8a3c7487f647ee61a">ADC_VOLT</a>(ch)&#160;&#160;&#160;( (float)mADCValue[ch] * mADCtoVoltsFactor)</td></tr>
<tr class="memdesc:gae008b1ced99b03c8a3c7487f647ee61a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the ADC voltage after the resistor divider. <br /></td></tr>
<tr class="separator:gae008b1ced99b03c8a3c7487f647ee61a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e5049a2cb9989832c5afe8f64224c64"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_STORE_VOLT</b>(i,  ch)&#160;&#160;&#160;( (float)mADCValueStore[i][ch] * mADCtoVoltsFactor)</td></tr>
<tr class="separator:ga5e5049a2cb9989832c5afe8f64224c64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga88e369a1a91af1d96b0e555a7d3357c5"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga88e369a1a91af1d96b0e555a7d3357c5">ADC_CURR_A</a>()&#160;&#160;&#160;( ((float)mADCValue[ADC_CH_CURR_A]-mDrvOffA) * mADCtoAmpsFactor )</td></tr>
<tr class="memdesc:ga88e369a1a91af1d96b0e555a7d3357c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the current in the shunt resister. <br /></td></tr>
<tr class="separator:ga88e369a1a91af1d96b0e555a7d3357c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ca8cc9adcfacd7011999071cad87ff9"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_CURR_B</b>()&#160;&#160;&#160;( ((float)mADCValue[ADC_CH_CURR_B]-mDrvOffB) * mADCtoAmpsFactor )</td></tr>
<tr class="separator:ga4ca8cc9adcfacd7011999071cad87ff9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9c691e16ee77756b46303a604ef734fc"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_STORE_CURR_A</b>(i)&#160;&#160;&#160;( ((float)mADCValueStore[i][ADC_CH_CURR_A]-mDrvOffA) * mADCtoAmpsFactor )</td></tr>
<tr class="separator:ga9c691e16ee77756b46303a604ef734fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9f2f0ad3fd5a3b4e207e93579862bed6"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ADC_STORE_CURR_B</b>(i)&#160;&#160;&#160;( ((float)mADCValueStore[i][ADC_CH_CURR_B]-mDrvOffB) * mADCtoAmpsFactor )</td></tr>
<tr class="separator:ga9f2f0ad3fd5a3b4e207e93579862bed6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafd4ea0313f41e66dfb802cad5d9102b0"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#gafd4ea0313f41e66dfb802cad5d9102b0">ADC_TEMP</a>(ch)&#160;&#160;&#160;((((1.43 - <a class="el" href="group___m_c.html#ga20ac88fd0e586934a686cd94507acede">ADC_PIN</a>(ch) )) / 0.0043F) + 25.0f)</td></tr>
<tr class="memdesc:gafd4ea0313f41e66dfb802cad5d9102b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the current temperature. <br /></td></tr>
<tr class="separator:gafd4ea0313f41e66dfb802cad5d9102b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5928835ef16339820b7bbdf5e56ad50d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5928835ef16339820b7bbdf5e56ad50d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>USE_OWN_SVPWM</b></td></tr>
<tr class="separator:a5928835ef16339820b7bbdf5e56ad50d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6f998668e961b6bd6c06f228c867441c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga6f998668e961b6bd6c06f228c867441c">mcfInit</a> (void)</td></tr>
<tr class="memdesc:ga6f998668e961b6bd6c06f228c867441c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Init the mc FOC peripherals, data and threads.  <a href="group___m_c.html#ga6f998668e961b6bd6c06f228c867441c">More...</a><br /></td></tr>
<tr class="separator:ga6f998668e961b6bd6c06f228c867441c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2232149a66082728b9da99abb79af8f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga2232149a66082728b9da99abb79af8f5">mcfSetDuty</a> (uint16_t a, uint16_t b, uint16_t c)</td></tr>
<tr class="memdesc:ga2232149a66082728b9da99abb79af8f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the duty time of the three PWM outputs in raw timer ticks.  <a href="group___m_c.html#ga2232149a66082728b9da99abb79af8f5">More...</a><br /></td></tr>
<tr class="separator:ga2232149a66082728b9da99abb79af8f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga45f402aec7a14d2e111d8b41405537c8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga45f402aec7a14d2e111d8b41405537c8">mcfSetCurrentFactor</a> (float in)</td></tr>
<tr class="memdesc:ga45f402aec7a14d2e111d8b41405537c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the current from min current to max current.  <a href="group___m_c.html#ga45f402aec7a14d2e111d8b41405537c8">More...</a><br /></td></tr>
<tr class="separator:ga45f402aec7a14d2e111d8b41405537c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3a0543c25c0a803a4e50b459f90cd73c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga3a0543c25c0a803a4e50b459f90cd73c">mcfSetCurrent</a> (float in)</td></tr>
<tr class="memdesc:ga3a0543c25c0a803a4e50b459f90cd73c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the current from min current to max current.  <a href="group___m_c.html#ga3a0543c25c0a803a4e50b459f90cd73c">More...</a><br /></td></tr>
<tr class="separator:ga3a0543c25c0a803a4e50b459f90cd73c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga711a95f3011d926019808a9a5e981d54"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga711a95f3011d926019808a9a5e981d54">mcfSetMotorLock</a> (uint8_t in)</td></tr>
<tr class="memdesc:ga711a95f3011d926019808a9a5e981d54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock or release the motor.  <a href="group___m_c.html#ga711a95f3011d926019808a9a5e981d54">More...</a><br /></td></tr>
<tr class="separator:ga711a95f3011d926019808a9a5e981d54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16e8a9920f71e4f0ecf8843f06f2cbd5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga16e8a9920f71e4f0ecf8843f06f2cbd5">mcfSetForcedCommutationFrequency</a> (float in)</td></tr>
<tr class="memdesc:ga16e8a9920f71e4f0ecf8843f06f2cbd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the motor in forced commutation with the given frequency.  <a href="group___m_c.html#ga16e8a9920f71e4f0ecf8843f06f2cbd5">More...</a><br /></td></tr>
<tr class="separator:ga16e8a9920f71e4f0ecf8843f06f2cbd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8d65a964f6f0f2babcea05229c113580"><td class="memItemLeft" align="right" valign="top">
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga8d65a964f6f0f2babcea05229c113580">mcfDumpData</a> (void)</td></tr>
<tr class="memdesc:ga8d65a964f6f0f2babcea05229c113580"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dumps the local data to the debug stream. <br /></td></tr>
<tr class="separator:ga8d65a964f6f0f2babcea05229c113580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga87f3558347386bf8de5accfcaca7f1bc"><td class="memItemLeft" align="right" valign="top">
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga87f3558347386bf8de5accfcaca7f1bc">mcfStartSample</a> (void)</td></tr>
<tr class="memdesc:ga87f3558347386bf8de5accfcaca7f1bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the sampling routine. <br /></td></tr>
<tr class="separator:ga87f3558347386bf8de5accfcaca7f1bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga72b92981287829c6e18f24a86c1a25a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga72b92981287829c6e18f24a86c1a25a8">mcfMeasureResistance</a> (void)</td></tr>
<tr class="memdesc:ga72b92981287829c6e18f24a86c1a25a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Routine to measure the resistance from fet, motor and cables.  <a href="group___m_c.html#ga72b92981287829c6e18f24a86c1a25a8">More...</a><br /></td></tr>
<tr class="separator:ga72b92981287829c6e18f24a86c1a25a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga062b203d7dbd73b767f803c3db2a9b9a"><td class="memItemLeft" align="right" valign="top">
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga062b203d7dbd73b767f803c3db2a9b9a">CH_IRQ_HANDLER</a> (Vector88)</td></tr>
<tr class="memdesc:ga062b203d7dbd73b767f803c3db2a9b9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">ADC1_2 IRQ handler. <br /></td></tr>
<tr class="separator:ga062b203d7dbd73b767f803c3db2a9b9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9e0d4707db48d6e2ed19e1d9f7ef298b"><td class="memItemLeft" align="right" valign="top">
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c.html#ga9e0d4707db48d6e2ed19e1d9f7ef298b">CH_IRQ_HANDLER</a> (VectorFC)</td></tr>
<tr class="memdesc:ga9e0d4707db48d6e2ed19e1d9f7ef298b"><td class="mdescLeft">&#160;</td><td class="mdescRight">ADC3 IRQ handler. <br /></td></tr>
<tr class="separator:ga9e0d4707db48d6e2ed19e1d9f7ef298b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>FOC implementation. </p>
<dl class="section author"><dt>Author</dt><dd>Noah Huetter (<a href="#" onclick="location.href='mai'+'lto:'+'noa'+'hh'+'uet'+'te'+'r@g'+'ma'+'il.'+'co'+'m'; return false;">noahh<span style="display: none;">.nosp@m.</span>uett<span style="display: none;">.nosp@m.</span>er@gm<span style="display: none;">.nosp@m.</span>ail.<span style="display: none;">.nosp@m.</span>com</a>) </dd></dl>
<dl class="section date"><dt>Date</dt><dd>12 April 2017 </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_a9195269ee5d9d706df69420a172dbff.html">mc</a></li><li class="navelem"><a class="el" href="mc__foc_8c.html">mc_foc.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
